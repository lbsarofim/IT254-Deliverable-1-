#include <Wire.h>
#include <SPI.h>
#include <Arducam.h>
#include <ArduCAM.h>
#include <MemoryFree.h>

#define CS_PIN 7

int pin = 12;
int led = 13;
int motion = 0;

Arducam Mini;
byte pic_buf[256]; 

void setup() {
  Serial.begin(115200);
  
  pinMode(pin, INPUT);
  pinMode(led, OUTPUT);

  SPI.begin();
  
  Arducam.begin(CS_PIN);
  
  if (!Arducam.init()) {
    Serial.println("Camera init failed!");
    while (1);
  }
  
  Serial.println("Camera initialized.");
}

void loop() {

  int pir_state = digitalRead(PIR_SENSOR_PIN);
  
    if(motion == HIGH){
    digitalWrite(led, HIGH);
    Serial.print("Motion detected");
    
    Arducam.flush_fifo();
    Arducam.start_capture();
    
    while (!Arducam.is_capture_done()) {
      delay(10); 
    }
    
    Serial.println("Picture captured.");
    
    Arducam.read_fifo(pic_buf, sizeof(pic_buf));
    

    delay(1000); 
  } else{
    digitalWrite(led, LOW);
    Serial.print("Motion stopped");
  }
  }

  delay(100); 
}

  else{
    digitalWrite(led, LOW);
    Serial.print("Motion stopped");
  }
}
